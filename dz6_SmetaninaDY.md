Домашнее задание 6
================
Сметанина Д.Я.
2024-04-16

# Домашнее задание 6

**Тема**: расчет выборки при планировании исследования.

**Цель**: научиться рассчитывать выборку для исследований с различными
конечными точками.

**Описание ДЗ**

При выполнении этого домашнего задания вам необходимо посчитать выборки
для различных типов точек. Напишите соответствующий код, пользуясь
указанными формулами.

Пусть наш спонсор заинтересован, чтобы исследование имело 80% мощность,
а уровень значимости — 5%, ожидаемый drop-out rate = 10%.

**Что нужно сделать:**

1.  (3 балла) Рассчитайте выборку для исследования терапевтической
    эквивалентности для двухпериодного cross-over дизайна. Из предыдущих
    исследований известно, что дисперсия составляет 20% (sigma_m = 0.20)
    , а разница средних составляет - 10% (epsilon = 0.10) . Клиницисты
    сообщают нам, что клинически значимая разница составляет 25% (delta
    = 0.25).

``` r
# Если в задании имеется ввиду именно дисперсия, то она уже в квадрате

# Задаем параметры
alpha <- 0.05 # уровень значимости
power <- 0.80 # мощность исследования
delta <- 0.25 # клинически значимая разница
epsilon <- -0.10 # разница средних
sigma_m <- 0.20 # дисперсия
dropout_rate <- 0.10 # ожидаемый процент отсева

# Нахождение критических значений Z для alpha и мощности
z_alpha_half <- qnorm(1 - alpha / 2) # для двустороннего теста
z_beta <- qnorm(power)

# Вычисляем размеры выборок
n1 <- n2 <- ((z_alpha_half + z_beta)^2 * (sigma_m)) / (2 * (delta - abs(epsilon))^2)

# Общий размер выборки с учетом отсева
n_total <- (n1 + n2) / (1 - dropout_rate)

# Округляем до ближайшего целого числа, так как размер выборки не может быть дробным
n1 <- ceiling(n1)
n2 <- ceiling(n2)
n1_adjusted <- ceiling(n_total / 2)
n_total <- ceiling(n_total)

# Вывод результатов
cat("Необходимое количество участников в каждой группе:", n1_adjusted, "\n")
```

    ## Необходимое количество участников в каждой группе: 39

``` r
cat("Общий размер выборки с учетом выбывших:", n_total, "\n")
```

    ## Общий размер выборки с учетом выбывших: 78

``` r
# Если все по формуле, то возводим в квадрат по формуле

# Задаем параметры
alpha <- 0.05 # уровень значимости
power <- 0.80 # мощность исследования
delta <- 0.25 # клинически значимая разница
epsilon <- -0.10 # разница средних
sigma_m <- 0.20 # дисперсия
dropout_rate <- 0.10 # ожидаемый процент отсева

# Нахождение критических значений Z для alpha и мощности
z_alpha_half <- qnorm(1 - alpha / 2) # для двустороннего теста
z_beta <- qnorm(power)

# Вычисляем размеры выборок
n1 <- n2 <- (((z_alpha_half + z_beta)^2) * (sigma_m^2)) / (2 * ((delta - abs(epsilon))^2))

# Общий размер выборки с учетом отсева
n_total <- (n1 + n2) / (1 - dropout_rate)

# Округляем до ближайшего целого числа, так как размер выборки не может быть дробным
n1 <- ceiling(n1)
n2 <- ceiling(n2)
n1_adjusted <- ceiling(n_total / 2)
n_total <- ceiling(n_total)

# Вывод результатов
cat("Необходимое количество участников в каждой группе:", n1_adjusted, "\n")
```

    ## Необходимое количество участников в каждой группе: 8

``` r
cat("Общий размер выборки с учетом выбывших:", n_total, "\n")
```

    ## Общий размер выборки с учетом выбывших: 16

2.  Рассчитайте выборку для гипотезы non-inferiority для двухвыборочного
    параллельного дизайна. Пусть клинически значимая разница = -0.1, то
    есть мы ожидаем разницу не меньше 10%, а долю ответов для тестового
    препарата = 0.65, в то время как нам известно из предыдущих
    исследований, что доля ответов у препарата сравнения составляет =
    0.85. Соотношение групп равно k = 1.

    ``` r
    # Задаем параметры
    alpha <- 0.05 # уровень значимости
    power <- 0.80 # мощность исследования
    p1 <- 0.85 # доля ответов у препарата сравнения
    p2 <- 0.65 # доля ответов для тестового препарата
    delta <- -0.10 # клинически значимая разница
    dropout_rate <- 0.10 # ожидаемый процент отсева
    k <- 1

    # Нахождение критических значений Z для alpha и мощности
    z_alpha_half <- qnorm(1 - alpha / 2) # для двустороннего теста
    z_beta <- qnorm(power)

    # Вычисляем размеры выборок
    n <- ((z_alpha_half + z_beta)^2 * (p1 * (1 - p1) + p2 * (1 - p2))) / ((p1 - p2 - delta)^2)

    # Общий размер выборки с учетом отсева и соотношения групп k
    n_total <- (n * (1 + k)) / (1 - dropout_rate)

    # Округляем до ближайшего целого числа, так как размер выборки не может быть дробным
    n1 <- ceiling(n)
    n2 <- ceiling(n)
    n1_adjusted <- ceiling(n_total / 2)
    n_total <- ceiling(n_total)
    n2_adjusted <- n1_adjusted  # так как n1 = n2

    # Вывод результатов
    cat("Необходимое количество участников в каждой группе:", n1_adjusted, "\n")
    ```

        ## Необходимое количество участников в каждой группе: 35

    ``` r
    cat("Общий размер выборки с учетом выбывших:", n_total, "\n")
    ```

        ## Общий размер выборки с учетом выбывших: 69

<!-- -->

3.  Рассчитайте выборку для гипотезы equality для следующего
    исследования. Мы хотим сравнить новую терапию инфекции,
    присоединяющейся в больничных условиях у пациентов с ожогами, с
    золотым стандартом, основываясь на данных, анализируемых с помощью
    регрессии Кокса. Пусть отношение рисков «золотой стандарт / новая
    терапия», hazard ratio, HR = 2. Мы предполагаем, что 80% пациентов
    (0.8) могут столкнуться с этим заболеванием. Соотношения групп
    терапии равны (p1 = p2 = 0.5).

``` r
# Задаем параметры
power <- 0.80 # Мощность исследования
alpha <- 0.05 # Уровень значимости
drop_out_rate <- 0.10 # Ожидаемый процент отсева
d <- 0.8 # Размер эффекта
HR <- 2 # Отношение рисков
p1 <- p2 <- 0.5 # Соотношения групп терапии

# Нахождение критических значений Z для alpha и мощности
Z_alpha <- qnorm(1 - alpha / 2)
Z_beta <- qnorm(power)

# Вычисляем размеры выборок
n1 <- n2 <- ((Z_alpha + Z_beta)^2) / ((log(HR)^2) * p1 * p2 * d)
#n1 <- n2 <- ((Z_alpha + Z_beta)^2) / ((log(HR^2)) * p1 * p2 * d)

n <- n1 + n2

# Общий размер выборки с учетом отсева
n_total <- n / (1 - drop_out_rate)

# Так как количество участников должно быть целым числом, округляем вверх
n1_adjusted <- ceiling(n_total / 2)
n2_adjusted <- n1_adjusted  # так как n1 = n2
n_total <- ceiling(n_total)

# Вывод результатов
cat("Необходимое количество участников в каждой группе:", n1_adjusted, "\n")
```

    ## Необходимое количество участников в каждой группе: 91

``` r
cat("Общий размер выборки с учетом выбывших:", n_total, "\n")
```

    ## Общий размер выборки с учетом выбывших: 182
